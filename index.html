<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Stunning Image Enhancement Tool</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: 'Poppins', sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); 
            color: rgb(255, 255, 255); 
            min-height: 100vh; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            padding: 20px; 
        }
        h1 { 
            font-size: 2.5em; 
            margin-bottom: 20px; 
            text-shadow: 0 4px 8px rgba(0,0,0,0.3); 
            animation: fadeIn 1s ease-in; 
        }
        .upload-area { 
            background: rgba(255,255,255,0.1); 
            border-radius: 20px; 
            padding: 20px; 
            margin-bottom: 20px; 
            text-align: center; 
            cursor: pointer; 
            transition: all 0.3s ease; 
        }
        .upload-area:hover { transform: scale(1.05); background: rgba(255,255,255,0.2); }
        #imgInput { display: none; }
        .controls { 
            display: flex; 
            gap: 20px; 
            margin-bottom: 30px; 
            flex-wrap: wrap; 
            justify-content: center; 
        }
        select, button { 
            background: linear-gradient(45deg, #FF6B6B, #4ECDC4); 
            color: rgb(141, 3, 3); 
            border: none; 
            border-radius: 50px; 
            padding: 12px 24px; 
            font-size: 16px; 
            font-weight: bold; 
            cursor: pointer; 
            transition: transform 0.3s ease; 
        }
        select:hover, button:hover { transform: scale(1.1); }
        .canvas-container { 
            display: flex; 
            gap: 30px; 
            justify-content: center; 
            flex-wrap: wrap; 
            margin-bottom: 20px; 
        }
        .canvas-card { 
            background: rgba(255,255,255,0.1); 
            border-radius: 20px; 
            padding: 20px; 
            box-shadow: 0 8px 32px rgba(0,0,0,0.2); 
            animation: slideIn 0.5s ease-out; 
        }
        canvas { 
            max-width: 400px; 
            border-radius: 10px; 
            box-shadow: 0 4px 8px rgba(0,0,0,0.3); 
        }
        .slider-container { 
            margin: 10px 0; 
            display: none; 
        }
        .slider-container.active { display: block; animation: fadeIn 0.5s; }
        input[type="range"] { width: 100%; }
        .download-btn { margin-top: 20px; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes slideIn { from { transform: translateY(20px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }
    </style>
</head>
<body>
    <h1>üñºÔ∏è Stunning Image Enhancement Tool</h1>
    <div class="upload-area" onclick="document.getElementById('imgInput').click()">
        üìÅ Upload Image to Start
    </div>
    <input type="file" id="imgInput" accept="image/*">

    <div class="controls">
        <select id="filterSelect">
            <option value="none">Select Filter</option>
            <option value="histogram">Histogram Equalization</option>
            <option value="contrast">Contrast Stretching</option>
            <option value="gamma">Gamma Correction</option>
            <option value="sharpen">Sharpening</option>
            <option value="smooth">Smoothing</option>
        </select>
        <div class="slider-container" id="contrastSliders">
            <label>Alpha (Contrast): <span id="alphaValue">2.0</span></label>
            <input type="range" id="alphaSlider" min="0.5" max="3.0" step="0.1" value="2.0">
            <label>Beta (Brightness): <span id="betaValue">10</span></label>
            <input type="range" id="betaSlider" min="-50" max="50" step="1" value="10">
        </div>
        <div class="slider-container" id="gammaSlider">
            <label>Gamma: <span id="gammaValue">0.8</span></label>
            <input type="range" id="gammaSlider" min="0.5" max="2.5" step="0.1" value="0.8">
        </div>
        <button onclick="applyFilter()">üöÄ Apply Filter</button>
        <button class="download-btn" onclick="downloadProcessed()" id="downloadBtn" style="display:none;">üíæ Download</button>
    </div>

    <div class="canvas-container">
        <div class="canvas-card">
            <h3>üì∏ Original</h3>
            <canvas id="originalCanvas"></canvas>
        </div>
        <div class="canvas-card">
            <h3>‚ú® Processed</h3>
            <canvas id="processedCanvas"></canvas>
        </div>
    </div>

    <script>
        let uploadedImage = new Image();
        let originalCanvas = document.getElementById('originalCanvas');
        let processedCanvas = document.getElementById('processedCanvas');
        let ctxOriginal = originalCanvas.getContext('2d');
        let ctxProcessed = processedCanvas.getContext('2d');

        // Upload
        document.getElementById('imgInput').addEventListener('change', (e) => {
            const file = e.target.files[0];
            const url = URL.createObjectURL(file);
            uploadedImage.src = url;
            uploadedImage.onload = () => {
                originalCanvas.width = uploadedImage.width;
                originalCanvas.height = uploadedImage.height;
                processedCanvas.width = uploadedImage.width;
                processedCanvas.height = uploadedImage.height;
                ctxOriginal.drawImage(uploadedImage, 0, 0);
                ctxProcessed.drawImage(uploadedImage, 0, 0);
            };
        });

        // Filter Select Change - Dynamic Sliders
        document.getElementById('filterSelect').addEventListener('change', (e) => {
            const value = e.target.value;
            document.getElementById('contrastSliders').classList.toggle('active', value === 'contrast');
            document.getElementById('gammaSlider').classList.toggle('active', value === 'gamma');
            // Live preview on change
            applyFilter(); // Apply immediately for preview
        });

        // Slider Updates
        ['alphaSlider', 'betaSlider', 'gammaSlider'].forEach(id => {
            document.getElementById(id).addEventListener('input', (e) => {
                document.getElementById(e.target.nextElementSibling.id || e.target.previousElementSibling.id).textContent = e.target.value;
                applyFilter(); // Live update
            });
        });

        // Filters (From Lab - JS Version)
        function applyFilter() {
            const filter = document.getElementById('filterSelect').value;
            ctxProcessed.drawImage(uploadedImage, 0, 0);
            let imageData = ctxProcessed.getImageData(0, 0, processedCanvas.width, processedCanvas.height);
            const data = imageData.data;

            if (filter === 'histogram') histogramEqualization(data);
            else if (filter === 'contrast') {
                const alpha = parseFloat(document.getElementById('alphaSlider').value);
                const beta = parseFloat(document.getElementById('betaSlider').value);
                contrastStretching(data, alpha, beta);
            }
            else if (filter === 'gamma') {
                const gamma = parseFloat(document.getElementById('gammaSlider').value);
                gammaCorrection(data, gamma);
            }
            else if (filter === 'sharpen') sharpeningFilter(data);
            else if (filter === 'smooth') smoothingFilter(data);

            ctxProcessed.putImageData(imageData, 0, 0);
            document.getElementById('downloadBtn').style.display = 'block';
        }

        function histogramEqualization(data) {
            let hist = new Array(256).fill(0);
            for (let i = 0; i < data.length; i += 4) {
                let gray = Math.round(0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2]);
                hist[gray]++;
            }
            let cdf = [];
            let cum = 0;
            const total = data.length / 4;
            for (let i = 0; i < 256; i++) {
                cum += hist[i];
                cdf[i] = Math.round(cum * 255 / total);
            }
            for (let i = 0; i < data.length; i += 4) {
                let gray = Math.round(0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2]);
                let val = cdf[gray];
                data[i] = data[i+1] = data[i+2] = val;
            }
        }

        function contrastStretching(data, alpha, beta) {
            let min = 255, max = 0;
            for (let i = 0; i < data.length; i += 4) {
                let gray = Math.round(0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2]);
                min = Math.min(min, gray);
                max = Math.max(max, gray);
            }
            const scale = 255 / (max - min);
            for (let i = 0; i < data.length; i += 4) {
                let gray = Math.round(0.299 * data[i] + 0.587 * data[i+1] + 0.114 * data[i+2]);
                let val = Math.min(255, Math.max(0, (gray - min) * scale * alpha + beta));
                data[i] = data[i+1] = data[i+2] = val;
            }
        }

        function gammaCorrection(data, gamma) {
            const invGamma = 1.0 / gamma;
            for (let i = 0; i < data.length; i += 4) {
                data[i] = 255 * Math.pow(data[i] / 255, invGamma);
                data[i+1] = 255 * Math.pow(data[i+1] / 255, invGamma);
                data[i+2] = 255 * Math.pow(data[i+2] / 255, invGamma);
            }
        }

        function sharpeningFilter(data) {
            const width = processedCanvas.width;
            const height = processedCanvas.height;
            const copy = new Uint8ClampedArray(data);
            const kernel = [[0, -1, 0], [-1, 5, -1], [0, -1, 0]];
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    let sumR = 0, sumG = 0, sumB = 0;
                    for (let ky = 0; ky < 3; ky++) {
                        for (let kx = 0; kx < 3; kx++) {
                            let px = x + kx - 1;
                            let py = y + ky - 1;
                            let idx = (py * width + px) * 4;
                            sumR += copy[idx] * kernel[ky][kx];
                            sumG += copy[idx+1] * kernel[ky][kx];
                            sumB += copy[idx+2] * kernel[ky][kx];
                        }
                    }
                    let idx = (y * width + x) * 4;
                    data[idx] = Math.min(255, Math.max(0, sumR));
                    data[idx+1] = Math.min(255, Math.max(0, sumG));
                    data[idx+2] = Math.min(255, Math.max(0, sumB));
                }
            }
        }

        function smoothingFilter(data) {
            const width = processedCanvas.width;
            const height = processedCanvas.height;
            const copy = new Uint8ClampedArray(data);
            for (let y = 1; y < height - 1; y++) {
                for (let x = 1; x < width - 1; x++) {
                    let sumR = 0, sumG = 0, sumB = 0;
                    for (let ky = 0; ky < 3; ky++) {
                        for (let kx = 0; kx < 3; kx++) {
                            let px = x + kx - 1;
                            let py = y + ky - 1;
                            let idx = (py * width + px) * 4;
                            sumR += copy[idx] / 9;
                            sumG += copy[idx+1] / 9;
                            sumB += copy[idx+2] / 9;
                        }
                    }
                    let idx = (y * width + x) * 4;
                    data[idx] = sumR;
                    data[idx+1] = sumG;
                    data[idx+2] = sumB;
                }
            }
        }

        function downloadProcessed() {
            const link = document.createElement('a');
            link.download = 'processed_image.png';
            link.href = processedCanvas.toDataURL();
            link.click();
        }
    </script>
</body>
</html>